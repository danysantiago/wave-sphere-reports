\section{Power Analysis}
The power analysis consists of four main parts: logic compatibility, driving capability, power supply design and battery life estimate. The purpose of this analysis is to ensure that power requirements for each component are satisfied, thus guaranteeing their functionality.

\subsection{Logic Compatibility}

Table \ref{tab:logicComp} shows all the digital components in the system along with their input and output digital voltage levels.  The table also includes a column labelled ``Notes" that contains assumptions made for determining each value that was not available in their data sheets.  Only two digital components communicate with each other: the SD Card to USB converter IC and the SD Card itself.  It is easy to see from Table \ref{tab:logicComp} that the logic voltage levels between these two devices are compatible.  In addition to this, all components communicate with the MCU.  It can also be seen that all the devices are logically compatible with the MCU except for the battery gauge, which communicates with the MCU through an $I^2C$ interface.  In order to make them compatible, a bi-directional logic level shifter using pass transistor logic was used and can be seen in the schematic.  The interface was only added in the data lines because it is bi-directional, while the clock signal comes from the MCU and can be correctly interpreted by the battery gauge according to the data sheet.


% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{center}

    \begin{longtable}{|p{1.2in}|c|c|c|c|c|p{1.8in}|}
    \caption{Logic Compatibility  \label{tab:logicComp}} \\
     \hline
    \rowcolor{Gray}
    Component & $V_{DD}$   & $V_{IH}$   & $V_{IL}$   & $V_{OH}$   & $V_{OL}$   & Notes \\
    \hline \hline \endfirsthead
    
         \hline
    \rowcolor{Gray}
    Component & $V_{DD}$   & $V_{IH}$   & $V_{IL}$   & $V_{OH}$   & $V_{OL}$   & Notes \\
    \hline \hline \endhead
    
    \endfoot

    MSP430FR5969 & 3.3   & 2.1   & 0.75  & 3.2   & 0.2   & Values are for the MSP430FR572x as they are not available for the selected microprocessor. \\ \hline
    Magnetometer & 3.3   & 2.64  & 0.66  & 3.3   & 0     & $V_{DD}$*0.8 and $V_{DD}$*0.2 Values assumed for $V_{IH}$ and $V_{IL}$ respectively, 0 and 3.3 for $V_{OH}$ and $V_{OL}$ because it uses CMOS technology \\ \hline
    XBee  & 3.3   & 2.838 & 0.594 & 2.838 & 0.594 & $V_{OH}$ and $V_{OL}$ assumed equal to $V_{IH}$ and $V_{IL}$ \\ \hline
    RF Wakeup & 3.3   & 1.914 & 0.99  & 2.9   & 0.4   & N/A \\ \hline
    Gyroscope & 3.3   & 2.64  & 0.66  & 2.64  & 0.66  & $V_{OH}$ and $V_{OL}$ assumed equal to $V_{IH}$ and $V_{IL}$ \\ \hline
    GPS   & 3.3   & 2     & 0.8   & 2.4   & 0.4   & N/A \\ \hline
    Battery Gauge & 2.5   & 1.2   & 0.6   & 2     & 0.4   & Logic voltage Shifter was added to the schematic. \\ \hline
    SD Card & 3.3 & 2.06   & 0.83   & 2.48   & 0.41  & Obtained from \cite{ibrahim2010sd} \\ \hline
    Power Switch & 3.3   & 2.2   & 1.1   & 3.3   & 0     & $V_{IH}$ and $V_{IL}$ were extrapolated from Data sheet. 3.3 and 0 were assumed for $V_{OH}$ and $V_{OL}$ because it uses CMOS technology \\ \hline
    SD Card to USB Converter & 3.3 & 2.06   & 0.83   & 2.48   & 0.41   & N/A \\ \hline
    \end{longtable}%
  
\end{center}%


\subsection{Driving Capability}

In order to ensure that no component draws more current than the one its driver can provide, a weakest driver analysis should be performed.  However, due to a serious lack of information in the data sheets of the selected components, this was not possible.  Table~\ref{tab:drivingCap} shows a list of the available currents found in the data sheets.  It can be seen that there is not enough information to perform the analysis on any component.  This will be taken into account when initial prototyping begins and interfacing for the pins, in the form of transistors to amplify current, will be added as needed.  Care will be taken when connecting components so that components are not damaged while prototyping: current will be limited by the power supply during the initial testing phase.

% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{table}[H]
  \centering
  \caption{List available of pin input, output and leakage currents}
    \begin{tabular}{|c|c|c|c|}
    \hline
    \rowcolor{Gray}
    Component & $I_{Out}$  & $I_{In}$   & $I_{Leak}$ \\
    \hline\hline
    MSP430FR5969 & 2 mA  & 2 mA  & Not Specified \\ \hline


    \multicolumn{4}{|c|}{\cellcolor{Gray}Connected Through SPI} \\ \hline
    XBee  & 4 mA  & 0.5 $\mu$A & Not Specified \\ \hline
    RF Wakeup & 21 mA  & 100 nA & 100 nA \\ \hline
    Gyroscope & Not Specified & Not Specified & Not Specified \\ \hline
    SD Card & Not Specified & Not Specified & 10 $\mu$A \\ \hline

    \multicolumn{4}{|c|}{\cellcolor{Gray}Connected Through $I^2C$} \\ \hline
    \multirow{2}{*}{Battery Gauge} & $I_{OL}$ = 0.5 mA & \multirow{2}{*}{Not Specified} & \multirow{2}{*}{Not Specified} \\
    & $I_{OH}$ = -1 mA & &\\ \hline
    Battery Charge & 10 $\mu$A  & 1 $\mu$A  & Not Specified \\ \hline
    Magnetometer & Not Specified & Not Specified & Not Specified \\ \hline
  
  	
    \multicolumn{4}{|c|}{\cellcolor{Gray}Connected Through UART} \\ \hline

    GPS   & Not Specified & Not Specified & 10 uA \\ \hline
   

    \multicolumn{4}{|c|}{\cellcolor{Gray}Connected Individually} \\ \hline
    3-Axis Accelerometer & Not Specified & Not Specified & Not Specified \\ \hline
    Power Switch & 10 mA & 10 mA & 0.3 uA \\ \hline
 	SD Card to USB Converter &  2 $\mu$ A     &    2 $\mu$ A      &  1 $\mu$ A   \\
    \hline
    \end{tabular}%
  \label{tab:drivingCap}
\end{table}%


\subsection{Power Supply Design}
In order to design the power supply that will be used by the system, the worst case quiescent current of each component should be taken into account.  Although not all components will be operating at the same time, it is ensured that the system will continue to function properly for the worst possible case by performing the analysis in this manner.  To ensure proper operation of the system, the Low-Dropout Regulator (LDO) must supply enough current for the entire system.  Table \ref{tab:powerSupply} shows a list of components along with the worst case quiescent current of each of them.  By adding all the current, a maximum current consumption of 181 mA was determined.  The LDO is rated for a maximum output of 500 mA, which is well above the determined usage. In order to complete the power supply circuit, a USB Battery Charger and a Battery Meter were added as well.  
\begin{table}[H]
  \centering
  \caption{Worst Case Quiescent Currents for components}
    \begin{tabular}{|c|c|}
     \hline
     \rowcolor{Gray}
    Component & $I_{DD(Active)}$ ($\mu$A) \\
     \hline \hline
    MSP430FR5969 & 1600   \\ \hline
    3-Axis Accelerometer & 300  \\ \hline
    Magnetometer & 110  \\ \hline
    XBee  & 45000 \\ \hline
    RF Wakeup & 2.7   \\ \hline
    Gyroscope & 6100  \\ \hline
    GPS   & 26140 \\ \hline
    SD Card & 100000  \\ \hline
    Power switch & 1  \\ \hline
    SD to USB & 37   \\ \hline
    LDO   & 65  \\ \hline
    Battery Charger & 1500  \\ \hline
    Battery Meter & 103   \\ \hline \hline
    Total & 180958.7  \\ \hline     
    \end{tabular}%
  \label{tab:powerSupply}%
\end{table}%

\subsection{Battery Life Estimate}
In order to estimate the battery life, the average supply current was determined by using a weighted average based on the fraction of time each component is active.  The weighted average formula used was: $I_{avg} = \alpha * I_{active} + (1 - \alpha) * I_{LPM}$, where $\alpha$ is the activity factor or the fraction of time the component is active.  The following assumptions were made when determining the activity factor.

\begin{itemize}
\item The drifters will spend 10 minutes in ``Locate Mode" before they are retrieved from the water.
\item The drifters will spend 30 seconds in sampling mode.
\item The drifters will spend 3 minutes in stand-by mode before they are deployed.
\item The drifters will spend about 10 seconds transferring a single data file.  The following assumptions were made to determine this time:
	\begin{itemize}
		\item File Size: 200 kB * 8 = 16,000 kbits.
		\item 80\% of XBee maximum Speed: 250 kbps * 80\% = 200 kbps.
		\item 16,000 kbits / 200 kbps = 8 seconds, which can be rounded up to 10 seconds.
	\end{itemize}
\end{itemize}


Table \ref{tab:batLife} shows a list of the components along with their active and low power mode supply current, determined activity factor, and weighted average supply current.  It also shows the total average current consumption of the system which was determined to be  around 70 mA.  This means that a chosen 500 mAh battery will last for about 7.23 hours.  Based on the current assumptions, a single throw or experiment will last for about 13.66 minutes, which means that the drifters will be able to perform at least 30 experiment trials under the current assumptions.

% Table generated by Excel2LaTeX from sheet 'Sheet2'
\begin{table}[H]
  \centering
  \caption{Estimate of Battery Life}
    \begin{tabular}{|c|c|c|c|c|}
     \hline
     \rowcolor{Gray}
    Component & $I_{DD(Active)}$ ($\mu$A) & $I_{DD(LPM)}$ ($\mu$A) & Activity Factor & $I_{DD(AVG)}$ ($\mu$A) \\
     \hline \hline
    \multicolumn{5}{|c|}{\cellcolor{Gray}Connected To LDO} \\ \hline
    MSP430FR5969 & 1600  & 0.5   & 78.05\% & 1248.91 \\ \hline
    3-Axis Accelerometer & 300   & 0     & 3.66\% & 10.98 \\ \hline
    Magnetometer & 110   & 1     & 3.66\% & 4.9894 \\ \hline
    XBee  & 45000 & 0.5   & 96.34\% & 43353.02 \\ \hline
    RF Wakeup & 2.7   & 0.4   & 0.00\% & 0.4 \\ \hline
    Gyroscope & 6100  & 5     & 3.66\% & 228.077 \\ \hline
    GPS   & 26140 & 5     & 73.17\% & 19127.98 \\ \hline
    SD Card & 100000 & 10    & 4.88\% & 4889.512 \\ \hline
    Power switch & 1     & 0.3   & 3.66\% & 0.32562 \\ \hline
    SD to USB & 37    & 1     & 100.00\% & 37 \\ \hline
    \multicolumn{5}{|c|}{\cellcolor{Gray}Connected Directly to Battery} \\ \hline
    LDO   & 65    & 1     & 100.00\% & 65 \\ \hline
    Battery Charger & 1500  & 6.5   & 0.00\% & 6.5 \\ \hline
    Battery Meter & 103   & 4     & 100.00\% & 103 \\ \hline \hline
    Total & 180958.7 & 35.2  &    -   & 69075.69 \\ \hline \hline
    Battery Capacity &   500 mAh    &      \multicolumn{2}{c|}{Hours of Use per battery charge} & 7.238436 \\ \hline
    Est. time per throw (min) & 13.66 mins  &    \multicolumn{2}{c|}{Throws per charged battery} & 31.7785 \\ \hline
    
    \end{tabular}%
  \label{tab:batLife}%
\end{table}%


